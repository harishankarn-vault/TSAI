kubeadm 1.6.2 has a bug. Use 1.6.1.
kubeadm is not supported for Redhat Linux version < 7
Make sure all hosted linux boxes (master and worker) run Linux 7.2 with docker 1.12.6 installed.
jenkins 2.32.1
influxdb/grafana/heapster


step 1 set proxy/update proxy if necessary

[root@localhost ~]#vi ~/.bashrc

export HTTPS_PROXY=http://web-proxy.sgp.hpecorp.net:8080
export https_proxy=http://web-proxy.sgp.hpecorp.net:8080
export NO_PROXY=
export no_proxy=
export HTTP_PROXY=http://web-proxy.sgp.hpecorp.net:8080
export http_proxy=http://web-proxy.sgp.hpecorp.net:8080

step 2. [root@localhost ~]#vi /etc/yum.conf  
#update proxy if necessary
PROXY=http://web-proxy.sgp.hpecorp.net:8080

step 3 :inital setup


[root@localhost ~]#yum clean all
[root@localhost ~]#yum install epel-release -y
[root@localhost ~]#yum install -y yum-utils device-mapper-persistent-data lvm2
[root@localhost ~]#yum install -y git vim lsof mlocate wget lynx netstat gcc telnet strace make autoconf vim yum-utils createrepo net-tools ntp* automake git libtool pkgconfig  flex bison     boost-devel 
libevent-devel zlib-devel python-devel ruby-devel
[root@localhost ~]#yum-config-manager --enable ol7_addons ol7_latest
[root@localhost ~]#yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
[root@localhost ~]#yum makecache fast



[root@localhost ~]#rpm --import https://mirror.go-repo.io/centos/RPM-GPG-KEY-GO-REPO
[root@localhost ~]#curl -s https://mirror.go-repo.io/centos/go-repo.repo | tee /etc/yum.repos.d/go-repo.repo
[root@localhost ~]#cat /etc/yum.repos.d/go-repo.repo
[root@localhost ~]#yum install golang go -y 
[root@localhost ~]#yum update golang go -y


#// If go is not inearly step  installed
[root@localhost ~]#yum install go 
[root@localhost ~]#go get github.com/kubernetes-incubator/cri-tools/cmd/crictl


step 4 :Setup NTP sync on all the machines
      [root@localhost ~]#yum install ntp
      [root@localhost ~]#systemctl  start ntpd
      [root@localhost ~]#systemctl status ntpd       
      [root@localhost ~]#systemctl enable ntpd 
        * NTP server is running
        
      [root@localhost ~]#service ntpd stop
      [root@localhost ~]#/etc/init.d/ntpd stop (or service ntpd stop)
      [root@localhost ~]#ntpdate pool.ntp.org
      [root@localhost ~]#chkconfig ntpd on
      [root@localhost ~]#/etc/init.d/ntpd stop (or service ntpd stop)
      [root@localhost ~]#service ntpd start
      [root@localhost ~]#ntpq -p

step 5 :In vi /etc/hosts add ip and host name
	    [root@localhost ~]# vi /etc/hosts

	    192.168.118.145     kubehost1
	    192.168.118.146     kubehost2	    
	    localhost		kubehost1
	    127.0.0.1         	kubehost1
	    

step 6 :Setup Environment Variables
	>>switch to hadoop user and setup following environment variables in vi .bashrc 
	#su - admin
	$cd /home/admin/
	$vi .bashrc
	export PATH=$PATH:$HOME/bin:/usr/bin:/root/go/bin
	export GOPATH=$HOME/go	
 	$source ~/.bashrc


	#su - admin
	#vi .bashrc
	export PATH=$PATH:$HOME/bin:/usr/bin:/root/go/bin
	export GOPATH=$HOME/go	
 	#source ~/.bashrc


step 7 :Stop iptables (firewall)
    4.1:[root@host1 ~]#systemctl disable firewalld  ( for centos 7.2.x)	
        [root@host1 ~]#systemctl stop firewalld  ( for centos 7.2.x)	
     
    4.2:disable selinux
	[root@localhost ~]#vi /etc/sysconfig/selinux	
 	SELINUX=disabled

    4.3:disable selinux

	[root@localhost ~]#setenforce 0

    4.4:disable ipv6 and give host name(example:host1) in vi /etc/sysconfig/network
	[root@localhost ~]#vi /etc/sysconfig/network
	NETWORKING=yes
	NETWORKING_IPV6=no
	HOSTNAME=kubehost1
	
    4.5 disable ipv6 
	[root@host1 ~]#echo "net.ipv6.conf.default.disable_ipv6=1" >> /etc/sysctl.conf
	[root@host1 ~]#echo "net.ipv6.conf.all.disable_ipv6 = 1" >> /etc/sysctl.conf
	[root@host1 ~]#echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf	
	[root@host1 ~]#sysctl -p
 

step 8 :  Create user & group on all the machines
create a group 'cloudties' with gid 599 and user cloudties

[root@localhost ~]#groupadd -g 599 cloudties
[root@localhost ~]#useradd -u 599 -g 599  cloudties

step 9  Add admin user to sudo 
[root@localhost ~]#visudo
admin   ALL=(ALL)       ALL
cloudties   ALL=(ALL)       ALL



step 10. Install docker
--------------------------------------------
#/usr/local/packages/aime/ias/run_as_root "su -"

[root@localhost ~]#yum list docker
	Available Packages
	docker.x86_64    2:1.13.1-53.git774336d.el7.centos 
----------------------------------------			
NOTE : READ FIRST 
[root@localhost ~]# yum install docker-engine-1.12.6 (do not use 'yum install docker', it installs docker 1.6 which is not supported by kubeadm)
--------------------------------------------

[root@localhost ~]#yum install  docker docker-selinux  -y 
[root@localhost ~]#docker -v
[root@localhost ~]#docker --version
[root@localhost ~]#docker version
[root@localhost ~]#docker --help
[root@localhost ~]#docker run --help

For docker machine only
[root@localhost ~]#base=https://github.com/docker/machine/releases/download/v0.16.0 &&   curl -L $base/docker-machine-$(uname -s)-$(uname -m) >/tmp/docker-machine &&   sudo mv /tmp/docker-machine /usr/local/bin/docker-machine &&   chmod +x /usr/local/bin/docker-machine
 



step 9. Check status of docker Ths message will show a error
[root@localhost ~]#systemctl status  docker -l 
 
step 10 Change docker storage directory
[root@localhost ~]#mkdir -p /opt/software/dockerstorage

step 11 Configure storage directory for docker 

[root@localhost ~]#vi /etc/sysconfig/docker
--------------------------------------------
-------------------------------------------
# Add these options if you want to change the way the docker daemon runs
OPTIONS='--selinux-enabled=false --group=docker -g /opt/software/dockerstorage'
--------------------------------------------

step 12 change network and proxy setting for docker , update proxy if necessary
--------------------------------------------
[root@localhost ~]#vi /etc/sysconfig/docker-network
DOCKER_NETWORK_OPTIONS="-H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock"
HTTP_PROXY=http://web-proxy.sgp.hpecorp.net:8080
HTTPS_PROXY=http://web-proxy.sgp.hpecorp.net:8080
#NO_PROXY="<non proxy ips>"
--------------------------------------------

step 13 Start docker
--------------------------------------------
[root@localhost ~]# systemctl start docker
[root@localhost ~]# systemctl status docker
[root@localhost ~]# systemctl enable docker
[root@localhost ~]# systemctl enable docker.service
[root@localhost ~]# systemctl start docker.service
[root@localhost ~]# docker version
[root@localhost ~]#docker info
[root@localhost ~]#docker run hello-world

Syntax : docker run [options] [image ] [command][args]


docker run hello-world
Unable to find image 'hello-world:latest' locally
Trying to pull repository docker.io/library/hello-world ...
sha256:97ce6fa4b6cdc0790cda65fe7290b74cfebd9fa0c9b8c38e979330d547d22ce1: Pulling from docker.io/library/hello-world
ca4f61b1923c: Pull complete
Digest: sha256:97ce6fa4b6cdc0790cda65fe7290b74cfebd9fa0c9b8c38e979330d547d22ce1
Status: Downloaded newer image for docker.io/hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.


step 13) Other docker folders 

[root@localhost docker]# ll  /var/lib/docker
[root@localhost docker]# ll /opt/software/dcokerstorage
[root@localhost docker]# cat  /var/log/messages
[root@localhost docker]# ls  /etc/docker


step 14) Docker command 

a) View all containers 
[root@localhost docker]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
7dd00cd85829        hello-world         "/hello"            15 minutes ago      Exited (0) 15 minutes ago                       vibrant_goldwasser

b) view currently running docker
[root@localhost docker]# docker ps
[root@localhost docker]# docker ps --format="table {{.ID}}\t{{.Image}}"



c) View docker contiener logs   
[root@localhost docker]# docker logs 7dd00cd85829
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
...........


d) View docker contiener history by passing  image id
[root@localhost docker]# docker history hello-world
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
f2a91732366c        4 months ago        /bin/sh -c #(nop)  CMD ["/hello"]               0 B
<missing>           4 months ago        /bin/sh -c #(nop) COPY file:f3dac9d5b1b030...   1.85 kB

d) View docker images   

[root@localhost docker]# docker images

 
step 15) Got to docker hub (https://hub.docker.com/) and look for  any long running images. Look for debian offitial repo and choose a image
   
   or use docker search 
   [root@localhost docker]#  docker search jessie
   INDEX       NAME                                                    DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
   docker.io   docker.io/nodesource/jessie                             The Official NodeSource Docker Images           3
   docker.io   docker.io/allansimon/gitlab-ci-jessie-python            Docker made for running faster automated t...   1                    [OK]
   docker.io   docker.io/dockette/jessie                               My Custom Debian Jessie                         1                    [OK]
   docker.io   docker.io/pacur/debian-jessie                           Pacur Debian Jessie                             1                    [OK]
 
15 ) Pull from docker hub. Wehre the repo name is debian and the image name is jessie
     [root@localhost docker]# docker pull debian:jessie
	Trying to pull repository docker.io/library/debian ...
	sha256:a69efd2cf1f83d7fe6a374aaf27974ed031d72b2886acb4b730c6a2017db0c3d: Pulling from docker.io/library/debian
	f2b6b4884fc8: Downloading [==========>                                        ] 10.68 MB/52.61 MB
	f2b6b4884fc8: Pull complete
	Digest: sha256:a69efd2cf1f83d7fe6a374aaf27974ed031d72b2886acb4b730c6a2017db0c3d
	Status: Downloaded newer image for docker.io/debian:jessie
 
16 ) run  the image we pulled  
     [root@localhost docker]# docker run debian:jessie
     [root@localhost docker]# docker ps -a

17) run  the image we pulled  with interactive terminal option 

     [root@localhost docker]# docker run -it debian:jessie /bin/bash
     
     now type debian command inside the debian container
     root@e9e198de6d07:/#ls

18) Login to a seperate terminal and run docker client 

    [root@localhost docker]#docker logs <conteinerid>
    [root@localhost docker]#docker history debian:jessie

19) Stopping  container 

    a) stop a containers
    [root@localhost docker]#docker stop  <conteinerid>
 
    b) stop all containers
     [root@localhost docker]#docker stop   $(docker ps -a -q)

21 . restart   the  docker container ( Note : dont use rm while starting the container )
     [root@localhost ~]# docker run  -d --name  cloudties -it 9e985b046eac sleep 600
     [root@localhost ~]# docker stop   cloudties  
     [root@localhost ~]# docker restart  cloudties  

22) Specify a name to a container 

    [root@localhost docker]#docker run  --name cloudties debian:jessie
    [root@localhost docker]#docker ps -a 



23) Remove a docker container ( Need to stop the container before we remove ) 
   a) 
    [root@localhost docker]#docker rm  cloudties ( conteiner name )
    [root@localhost docker]#docker rm  cloudties ( conteiner id) 
     [root@localhost docker]#docker rm 0c571a715130  2731ef1dc007 5b28257ab6c5

   b) Remove all container at once 
      [root@localhost docker]#docker rm  $(docker ps -a -q)
 
   
 
24) Run docker in detached mode or as a daemon

    [root@localhost docker]#docker run  --name cloudties -d debian:jessie sleep  600

    72956f6918f743640b2f7ccba492e30620d86df08934657a3442286580e8401d  ( This is containers process id )
    
    #view the process 
    [root@localhost docker]#docker ps 
    
    #login to the running container 
    [root@localhost docker]#docker exec -it cloudties /bin/bash

25) Run docker in detached mode or as a daemon and remove after the completion of work
    1) on reaching sleep / or explisit exit or on completion of program
    [root@localhost docker]#docker run --rm --name cloudties -d debian:jessie sleep  600


26) Pause the docker  container
     [root@localhost docker]#docker run  --name cloudties -d debian:jessie sleep  600
     [root@localhost docker]#docker pause   cloudties 
     [root@localhost ~]# docker ps -a


27) Resume the docker  container
     [root@localhost docker]#docker unpause  cloudties 
     [root@localhost ~]# docker ps -a


28) Find  the docker  status
    [root@localhost ~]# docker stats cloudties

29) Find  the docker  inspect
    [root@localhost ~]# docker inspect cloudties

30) Portmapping from the command port . Install tomcat version  8.0 and make in listen on port 8888
   [root@localhost ~]#docker run  -it -p 8888:8080  tomcat:8.0

   Now tomcat will be running 
   
   Using the browser launch http://localhost:8888 in browser 
   or 
   lynx http://localhost:8888

31) Kill a docker container ( for abrupt killing )

    [root@localhost ~]#docker kill practical_bell
 
32) Building a docker image 

   a) create a account cloudties in dockerhub at https://hub.docker.com/
   
   b) create a iamge from commit
   
   [root@localhost ~]#docker stop cloudties
   [root@localhost ~]#docker rm cloudties
   [root@localhost ~]#docker run -it --name cloudties debian:jessie 

        nside the image run the followinw
	root@4dacfa1c958b:/# apt-get update
	root@4dacfa1c958b:/# apt-get install git
  	 
  	Now we have install in the container and make sure we have git is running
        root@4dacfa1c958b:/# git
	
	
	convert  this in to a new comtienr for which stop the running conteiner 
	[root@localhost ~]#docker ps
	CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
	4dacfa1c958b        debian:jessie       "bash"              4 minutes ago       Up 4 minutes                            cloudties
	
	[root@localhost ~]#docker stop 4dacfa1c958b 
	[root@localhost ~]#docker ps
	[root@localhost ~]# docker commit 4dacfa1c958b cloudties/debian:5.0

	Here:  cloudties/debian:5.0--------------- username/imagename:tag
	here the username cloudties is the accoutn name in the dockerhub 

	[root@localhost ~]# docker images
	REPOSITORY              TAG                 IMAGE ID            CREATED              SIZE
	cloudties/debian        5.0                 58293b70900c        About a minute ago   219 MB

	push the image to the dockerhub . Login to the docker hub account 
	[root@localhost docker]# docker login --username cloudties
	Password:
	Login Succeeded
	[root@localhost ~]#docker push cloudties/debian:5.0
    
        Go to   https://hub.docker.com/ login as cloudties and see the public image
        
     c) create a iamge from Dockerfile  ( Naming Convention of docker file always starts with D). Here we are creating a centos iamge

     [root@localhost ~]# mkdir /opt/build
     [root@localhost ~]# cd /opt/build
 
     d)  [root@localhost ~]# vi  Dockerfile [method 1]
      
#   from what base image you want to build image
FROM  debian:jessie     
#   who is the mainter
MAINTAINER   info@cloudties.in       
RUN  apt-get update  -y
RUN  apt-get  install  apache2  -y 
EXPOSE 80
#   command that you want to run on startup of container
CMD  ["echo","Hello World"]         
RUN apt-get  install vim  -y 
RUN  apt-get  install lynx  -y 

     [root@localhost ~]#docker build -t cloudties/debian:5.0 /opt/build
     
     To trigger  next build from same dockerfile with out using the docker cache 
     
     [root@localhost ~]#docker build -t cloudties/centos:5.0 /opt/build --no-cache=true
      [root@localhost ~]#docker images
      [root@localhost ~]#docker run --rm --name cloudties -it -p 7777:80 9e985b046eac  /bin/bash
     [root@localhost ~]#docker ps
      [root@localhost ~]#lynx  http://localhost:7777 
 


    e)  [root@localhost ~]# vi  Dockerfile [method 2 to avoid building  mutiple layers of images]
    
#   from what base image you want to build image
FROM  debian:jessie                  
#   who is the mainter
MAINTAINER   info@cloudties.in       
RUN  apt-get update  -y && apt-get install   vim  lynx  apache2 wget  -y   
EXPOSE 80
#   command that you want to run on startup of container
CMD  ["echo","Hello World"]  
CMD  ["apache2ctl","-DFOREGROUND"]         
      
      
      
      [root@localhost ~]#docker build -t cloudties/debian:5.0 /opt/build
        
      To trigger  next build from same dockerfile with out using the docker cache 
        
      [root@localhost ~]#docker build -t cloudties/debian:5.0 /opt/build --no-cache=true
      [root@localhost ~]#docker images
      [root@localhost ~]#docker run --rm  --name cloudties -it  -p  7777:80 107ec4b2728c  /bin/bash
      
      [root@localhost ~]#docker ps
      [root@localhost ~]#lynx  http://localhost:7777 
     
     
    f)Push the image to the dockerhub . Login to the docker hub account 
    
	[root@localhost docker]# docker login --username cloudties
	Password:
	Login Succeeded
	[root@localhost ~]#docker push cloudties/debian:5.0
       
 
32) Remove a docker image 

[root@localhost docker]# docker images
REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE
cloudties/debian         5.0                 58293b70900c        9 minutes ago       219 MB
docker.io/tomcat          8.0                 7aa9e977bdb9        2 weeks ago         456 MB

[root@localhost ~]#docker rmi 7aa9e977bdb9

33) Find all the types of network in the conteiner  
[root@localhost ~]# docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
f912044531b5        bridge              bridge              local
c5d8d7715e3c        host                host                local
83649b4d1263        none                null                local

34 ) Run docker network in none network mode 
[root@localhost ~]#docker run --rm --name cloudties -it -p 7777:80  --net none 9e985b046eac  /bin/bash

inside docker try this . only loop back is seen 
root@793e09674a49:/# ip a


35 ) Run docker network in none network mode 
[root@localhost ~]#docker run --rm --name cloudties -it  --net bridge 9e985b046eac  /bin/bash

inside docker try this . two ip interfaces are listed   
root@ad67f0ec318a:/# ip a


 [root@localhost ~]#docker run -d --net bridge --rm  --name container1 busybox sleep 600
 [root@localhost ~]#docker run -d --net bridge --rm  --name container2 busybox sleep 600
 [root@localhost ~]# docker ps -a
 
 [root@localhost ~]#docker exec -it container2 /bin/ash
/ #
/ # ifconfig
    eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:04
          inet addr:172.17.0.4  Bcast:0.0.0.0  Mask:255.255.0.0
/ # ping 172.17.0.3

36 ) Create a custom network in docker 

[root@localhost ~]#docker network create --driver bridge bridge1  
[root@localhost ~]# docker network create --driver bridge bridge1
2631fbd74877ccde079108641fdd254082922d6831e23c2205431c40dcb9fbd0
[root@localhost ~]#
[root@localhost ~]# docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
f912044531b5        bridge              bridge              local
2631fbd74877        bridge1             bridge              local
c5d8d7715e3c        host                host                local
83649b4d1263        none                null                local

[root@localhost ~]#docker run --rm --name cloudties -it --net bridge1  busybox   /bin/ash
[root@localhost ~]#docker run --rm --name cloudties -it --net bridge1  busybox   /bin/ash
/ #
/ # ifconfig
eth0      Link encap:Ethernet  HWaddr 02:42:AC:12:00:02
          inet addr:172.18.0.2  Bcast:0.0.0.0  Mask:255.255.0.0


37) Make the container in two different bridges to communicate each pother 
/ # ping 172.17.0.2
PING 172.17.0.2 (172.17.0.2): 56 data bytes

 ping wont work here as they are differnet bridges 
 
 Now to make them ping we need to use docker entry point using docker connect 

[root@localhost build]# docker run -d --net bridge --rm  --name container1 busybox sleep 600
106dffd11e234833cc0a8c00a056bc4c028fe0ed24a12e26ce10573d04056640
[root@localhost build]# docker run -d --net bridge --rm  --name container2 busybox sleep 600
630efdafd71be6294f5a3783a12dcd76a5f19816be7cb62d09ede6fd60504e5a
[root@localhost build]# docker run -d --net bridge1 --rm  --name container3 busybox sleep 600
41b9ed96e683aa1490111b80dd44db76d5a7b1d7085ab20b7cfc83c105e92327


[root@localhost ~]#docker network connect bridge  container3
[root@localhost build]# docker exec -it container3 /bin/ash
/ # ping 172.17.0.2
PING 172.17.0.2 (172.17.0.2): 56 data bytes
64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.165 ms
64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.113 ms
^C
--- 172.17.0.2 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.113/0.139/0.165 ms
/ # ping 172.17.0.2
PING 172.17.0.2 (172.17.0.2): 56 data bytes
64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.088 ms
64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.117 ms
^C
--- 172.17.0.2 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.088/0.102/0.117 ms

/ # exit

[root@localhost build]# docker exec -it container1 /bin/ash
/ #
[root@localhost build]# docker exec -it container1 /bin/ash
/ #
/ # ping 172.18.0.2
PING 172.18.0.2 (172.18.0.2): 56 data bytes
not pingining

[root@localhost ~]#docker network connect bridge1  container1

[root@localhost build]# docker network connect bridge1  container1
[root@localhost build]#
[root@localhost build]# docker exec -it container1 /bin/ash
/ # ping 172.18.0.2
PING 172.18.0.2 (172.18.0.2): 56 data bytes
64 bytes from 172.18.0.2: seq=0 ttl=64 time=0.118 ms
64 bytes from 172.18.0.2: seq=1 ttl=64 time=0.118 ms

/ # exit


[root@localhost build]# docker exec -it container1 /bin/ash
/ # ifconfig
eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02
          inet addr:172.17.0.2  Bcast:0.0.0.0  Mask:255.255.0.0
          inet6 addr: fe80::42:acff:fe11:2/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:31 errors:0 dropped:0 overruns:0 frame:0
          TX packets:35 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:2462 (2.4 KiB)  TX bytes:3126 (3.0 KiB)

eth1      Link encap:Ethernet  HWaddr 02:42:AC:12:00:03
          inet addr:172.18.0.3  Bcast:0.0.0.0  Mask:255.255.0.0
          inet6 addr: fe80::42:acff:fe12:3/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:14 errors:0 dropped:0 overruns:0 frame:0
          TX packets:14 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1124 (1.0 KiB)  TX bytes:1124 (1.0 KiB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

38) Make the container in host network mode 

[root@localhost build]# docker run -d --net host --rm  --name container5 busybox sleep 600

[root@localhost build]# docker run -d --net host --rm  --name container5 busybox sleep 600
2caa3ea56dada60bc272321826a4575aaed78a202830b96460f9af39298d9b71
[root@localhost build]# docker exec -it container5 /bin/ash
/ # ifconfig
br-2631fbd74877 Link encap:Ethernet  HWaddr 02:42:92:C9:93:B6
          inet addr:172.18.0.1  Bcast:0.0.0.0  Mask:255.255.0.0
          inet6 addr: fe80::42:92ff:fec9:93b6/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:34 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:2320 (2.2 KiB)  TX bytes:210 (210.0 B)

docker0   Link encap:Ethernet  HWaddr 02:42:78:A9:A1:F7
          inet addr:172.17.0.1  Bcast:0.0.0.0  Mask:255.255.0.0
          inet6 addr: fe80::42:78ff:fea9:a1f7/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:134290 errors:0 dropped:0 overruns:0 frame:0
          TX packets:176429 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:8128734 (7.7 MiB)  TX bytes:474992620 (452.9 MiB)

eno16777736 Link encap:Ethernet  HWaddr 00:0C:29:99:BF:CC
          inet addr:192.168.0.105  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:29ff:fe99:bfcc/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:988843 errors:0 dropped:0 overruns:0 frame:0
          TX packets:365747 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1270421211 (1.1 GiB)  TX bytes:132246060 (126.1 MiB)


40. Creating Docker Volumes [method 1] by defiing the volume first 
[root@localhost build]# docker volume create volume1

41 . List volume 
[root@localhost ~]# docker volume ls
DRIVER              VOLUME NAME
local               volume1


42 . inspect docker volume 
[root@localhost ~]# docker volume inspect volume1
[
    {
        "Driver": "local",
        "Labels": {},
        "Mountpoint": "/opt/software/dcokerstorage/volumes/vlume1/_data",
        "Name": "volume1",
        "Options": {},
        "Scope": "local"
    }
]



 
43 . delete the  docker volume 
[root@localhost ~]# docker volume rm volume1


44 . attach  the  docker volume to a container
[root@localhost ~]# docker run  -d --name  cloudties -it   -v /opt/software/dcokerstorage/volumes/volume1:/opt/docker/volume1 9e985b046eac sleep 600


45 
[root@localhost ~]# docker exec -it cloudties /bin/bash

/ #

45. Creating Docker Volumes [method 2] not defiing the volume initally 
[root@localhost ~]# docker run  -d --name  cloudties -it   -v  /opt/docker/volume2 9e985b046eac sleep 600


[root@localhost ~]# docker inspect  volume1
# get the mount details from the JSOn

[root@localhost ~]# docker exec -it cloudties /bin/bash
/ #

46 attach the same volume to another container 
[root@localhost ~]# docker run  -d --name  cloudties1 -it   -v  /opt/docker/volume2 9e985b046eac sleep 600

[root@localhost ~]# docker run  -d --name  cloudties2 -it   --volumes-from   cloudties1  9e985b046eac sleep 600
[root@localhost ~]# docker run   -d --name  cloudties4    --volumes-from   cloudties1 sleep 600



47 docker compose 
For docker compose only

[root@localhost ~]#yum install -y py-pip python-dev libffi-dev openssl-dev gcc libc-dev  make

[root@localhost ~]# yum install -y python-pip  
[root@localhost ~]# pip install docker-compose
[root@localhost ~]# docker-compose version
 
-----------------------------------------------------------------
or 
sudo curl -L "https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
updatedb
locate docker-compose
ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
docker-compose --version
docker-compose up 


50 Uninstall docker

--------------------------------------------------------------------
# Delete all containers
[root@localhost ~]# docker rm $(docker ps -a -q)
# Delete all images
[root@localhost ~]# docker rmi $(docker images -q)
[root@localhost ~]# systemctl stop docker
[root@localhost ~]# systemctl disable docker
[root@localhost ~]# yum list installed | grep -i docker
[root@localhost ~]# yum -y remove docker // similarly remove any other docker packages listed by yum list
[root@localhost ~]# umount /scratch/docker
# assuming you followed the instructions earlier in this wiki to pull down the docker binaries to /scratch/docker
[root@localhost ~]# rm -rf /scratch/docker
[root@localhost ~]# systemctl reboot
--------------------------------------------------------------------
	 


Single-machine Kubernetes cluster

By default, your cluster will not schedule pods on the master for security reasons. If you want to be able to schedule pods on the master (you just have one host), e.g. a single-machine Kubernetes cluster for development, run:
--------------------------------------------
[root@]# kubectl taint nodes --all node-role.kubernetes.io/master-node "localhost" tainted
error: taint "node-role.kubernetes.io/master:" not found
--------------------------------------------



Joining your nodes
do this only in worker hosts
--------------------------------------------------
# These environment variables are needed for kubectl to run correctly. I have added them in ~/.bashrc
export KUBECONFIG=$HOME/admin.conf
export HTTP_PROXY=http://web-proxy.sgp.hpecorp.net:8080
export http_proxy=http://web-proxy.sgp.hpecorp.net:8080
export HTTPS_PROXY=http://web-proxy.sgp.hpecorp.net:8080
export https_proxy=http://web-proxy.sgp.hpecorp.net:8080
# Note: 10.196.15.117 is ip address of master node
export NO_PROXY=localhost,127.0.0.1,/var/run/docker.sock,<ip of the master node>
export no_proxy=localhost,127.0.0.1,/var/run/docker.sock,<ip of the master node>
  
[root@]# kubectl get nodes
NAME       STATUS         AGE
machine1   Ready          23h
machine2   Ready,master   1d
machine3   Ready          23h
--------------------------------------------------


Verify kubeadm version :

------------------------------------------------------------------------
[root@]# kubeadm version
kubeadm version: version.Info{Major:"1", Minor:"6", GitVersion:"v1.6.1", GitCommit:"b0b7a323cc5a4a2019b2e9520c21c7830b7f708e", GitTreeState:"clean", BuildDate:"2017-04-03T20:33:27Z", GoVersion:"go1.7.5", Compiler:"gc", Platform:"linux/amd64"}
------------------------------------------------------------------------
 
Run following command to setup Kubernete dashboard on master node

--------------------------------------------------------------------------
# download and deploy kubernetes dashboard app
kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml
 
kubectl proxy &
 
# You can reach by hitting the nodePort for the dashboard on the master
kubectl describe services kubernetes-dashboard --namespace=kube-system
NodePort:       <unset> 31550/TCP
--------------------------------------------------------------------------

kubectl will handle authentication with apiserver and make Dashboard available at http://localhost:8001/ui

Access dashboard from any host: http://host1:31550 (Note that NodePort is no longer the default exposing method of dashboard in a later version, in this case you can access it via cluster IP e.g. <ip> from master)

 

Adding Graphs to Kubernetes dashboard (optional)

Note: Do this only for master host. 

CPU and memory graphs are not available by default in Kubernetes dashboard. If you want to add CPU and memory graphs, deploy heapster based on instructions on this blog

Once Heapster is deployed, you should see graphs on Kubernetes dashboard:

Install Weave Scope (optional)

Note: Do this only for master host.

Install Weave Scope 

--------------------------------------------------------------
# The simplest way to get the latest release of Scope deployed onto a Kubernetes cluster is by running the following:
kubectl create namespace weave-scope
kubectl apply -f 'https://cloud.weave.works/launch/k8s/weavescope.yaml' --namespace weave-scope
 
# Open Scope in Your Browser
kubectl port-forward $(kubectl get pod --namespace weave-scope --selector=weave-scope-component=app -o jsonpath='{.items..metadata.name}') 4040 --namespace weave-scope
# Open any Weave Scope url in a browser on master node: http://localhost:4040.
--------------------------------------------------------------


Install Grafana and Prometheus (optional)
Note: Do this only for master host. 

----------------------------------------------------------------
bash-4.2$ pwd
/scratch/sock-shop/microservices-demo
 
bash-4.2$ kubectl create -f deploy/kubernetes/manifests-monitoring/
----------------------------------------------------------------

Grafana will be exposed on the NodePort 31300 and Prometheus is exposed on 31090:

Prometheus - is the central piece, it contains the time series database and the logic of scraping stats from exporters as well as alerts.
Grafana is the ‘face’ of Prometheus. While Prometheus exposes some of its internals like settings and the stats it gathers via basic web front-ends, it delegates the heavy lifting of proper graphical displays and dashboards to Grafana.

https://github.com/microservices-demo/microservices-demo/tree/master/deploy/kubernetes

Scale up/down a Deployment

Note: Do this only for master host. 

Prerequisite for this step - "weave-scope-app" is already deployed. See above step

Scale up "weave-scope-app" app to 2 replicas:

---------------------------
kubectl scale deployment weave-scope-app --replicas 2
---------------------------

Scale down "weave-scope-app" back to 1 replica:

-----------------------------------
kubectl scale deployment weave-scope-app --replicas 1
-----------------------------------



kubectl cheat sheet

kubectl completion
Enable kubernetes completion via adding this to your ~/.bashrc:
---------------------------------------
source <(kubectl completion bash)
---------------------------------------

To use bash completion, type the following and get tab completion on pods (or services, replication controllers etc). Any command that takes a pod, replication controller or service name should now have lovely tab completion! e.g. kubectl logs, kubectl exec etc!

--------------------------------------------
[root@~]# kubectl get nodes host[tab][tab]
host1 host2 host3
[root@]# kubectl get pods weave-scope-a[tab][tab]
weave-scope-agent-kxfvg          weave-scope-agent-xjvkl          weave-scope-app-681980193-bxmk9
--------------------------------------------

Setting the namespace preference
You can permanently save the namespace for all subsequent kubectl commands in that context.

--------------------------------------------------------
 kubectl config set-context $(kubectl config current-context) --namespace=<insert-namespace-name-here>
# Validate it
$ kubectl config view | grep namespace
--------------------------------------------------------

https://kubernetes.io/docs/getting-started-guides/kubeadm/
https://github.com/kubernetes/dashboard
https://github.com/microservices-demo/microservices-demo
https://www.weave.works/docs/scope/latest/installing/#k8s
https://coreos.com/blog/monitoring-kubernetes-with-prometheus.html
http://www.tothenew.com/blog/how-to-setup-kubernetes-master-ha-on-centos/


https://www.youtube.com/channel/UCZ2bu0qutTOM0tHYa_jkIwg
https://www.youtube.com/channel/UCvqbFHwN-nwalWPjPUKpvTA
https://www.youtube.com/watch?v=o85VR90RGNQ
https://www.youtube.com/watch?v=b_fOIELGMDY

https://icicimov.github.io/blog/kubernetes/Kubernetes-cluster-step-by-step-Part6/
https://blog.frognew.com/2018/03/kubeadm-install-kubernetes-1.10.html
https://github.com/kubernetes/kubeadm/issues/657
https://www.ianlewis.org/en/how-kubeadm-initializes-your-kubernetes-master
https://blog.alexellis.io/kubernetes-in-10-minutes/


https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-reset/
http://www.joseluisgomez.com/category/containers/
https://kubernetes-v1-4.github.io/docs/user-guide/kubectl/kubectl_create_namespace/
https://vadosware.io/post/fresh-dedicated-server-to-single-node-kubernetes-cluster-on-coreos-part-3/


https://github.com/kubernetes/kubernetes/issues/44522
https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
http://kubernetesbyexample.com/
https://icicimov.github.io/blog/kubernetes/Kubernetes-cluster-step-by-step-Part6/


https://vadosware.io/post/fresh-dedicated-server-to-single-node-kubernetes-cluster-on-coreos-part-3/